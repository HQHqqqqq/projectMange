webpackJsonp([3],{MrUN:function(e,t){},"kbo/":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),s=a.n(r),i=a("bOdI"),l=a.n(i),n=a("NYxO"),o=a("P9l9"),c=a("FOZ6"),m=a("14gb"),u={data:function(){var e;return{id:"",classUnitBId:"",classUnitCId:"",MilepostChangeStatus:!1,milestoneArray:[],milestoneUsed:[],projectName:"",changeBtnloading:!1,projectNumber:this.$route.query.projectNum,gtItemStatus:!1,changeReason:"",UsedTempName:"",configDatas:{options:{switch:(e={head:!0,sonSelect:!0,isContractDeliverable:!0},l()(e,"sonSelect",!0),l()(e,"time3",!1),l()(e,"workHours",!0),e)}}}},created:function(){this.getTableData(),"-1814768306395265967"==this.userinfo.account_id?(this.gtItemStatus=!0,this.configDatas.options.switch.isContractDeliverable=!0):(this.gtItemStatus=!1,this.configDatas.options.switch.isContractDeliverable=!1)},components:{ProjectMilestone:c.a},computed:s()({},Object(n.c)(["userinfo"])),methods:{getMilepostChangeStatus:function(e){this.MilepostChangeStatus=e},getTableData:function(){var e=this,t={projectNumber:this.projectNumber};Object(o._28)("/sgpm/rest/api/server/milestone/change",t).then(function(t){200==t.data.code?(t.data.data,e.id=t.data.data.id,e.milestoneArray=t.data.data.milestoneArray,e.milestoneUsed=t.data.data.milestoneUsed,e.projectName=t.data.data.projectName,e.versionNumber=t.data.data.versionNumber,e.UsedTempName=t.data.data.milestoneUsed[0].milestoneTemplateName,e.changeReason=t.data.data.changeDescription,e.classUnitBId=t.data.data.classUnitBId,e.classUnitCId=t.data.data.classUnitCId,m.a.$emit("milestoneArray",t.data.data.milestoneArray)):e.$message.error("获取数据失败")}).catch(function(e){})},milepostChangeSubmit:function(){var e=this,t=JSON.parse(localStorage.getItem("MilestoneParams"));if(!t)return this.$message.warning("请选一个里程碑模板");if(!this.$refs.projectMilestone.checkMilestoneParams(t))return this.$message.warning("请填写全部里程碑数据");if(!this.changeReason)return this.$message.warning("请填写变更原因");this.changeReason,this.changeBtnloading=!0;var a={};this.MilepostChangeStatus||(a.id=this.id),a.projectNumber=this.projectNumber,a.projectName=this.projectName,a.classUnitBId=this.classUnitBId,a.classUnitCId=this.classUnitCId,a.username=this.userinfo.login_name,a.companyId=this.userinfo.account_id,a.changeDescription=this.changeReason;var r=[];t.forEach(function(e){if(e.deliverableStatus){var t={};t.stageName=e.stageName,t.milestoneName=e.milestoneName,t.estimatedStartDate=e.expectedBeginTime,t.estimatedFinishDate=e.expectedEndTime,t.estimatedWorkingHours=e.workHours,t.progressPercentage=e.progressPercentage,t.sortIndex=1,t.isCut=e.isCut,t.status=0,t.description=e.description,t.milestoneTemplateName=e.milestoneTemplateName,t.milestoneTemplateId=e.milestoneTemplateId;var a=[];e.deliverable.forEach(function(e){if(e.checkedStatus){var t={};t.deliverableName=e.deliverableName,t.isCut=e.isCut,t.auditDeliverable=e.auditDeliverable,t.deliverableTemplateId=e.deliverableId,t.contractDeliverable=e.contractDeliverable,t.description=e.description,t.status=1,t.fileName=e.fileName,t.filePath=e.filePath,t.file_url=e.file_url,a.push(t)}}),t.deliverable=a,r.push(t)}});var s=[];this.milestoneUsed.forEach(function(e){var t={};t.stageName=e.stageName,t.milestoneName=e.milestoneName,t.estimatedStartDate=e.expectedBeginTime,t.estimatedFinishDate=e.expectedEndTime,t.estimatedWorkingHours=e.workHours,t.currentProblems=e.currentProblems,t.progressPercentage=e.progressPercentage,t.accumulatedProgress=e.accumulatedProgress,t.isCut=e.isCut,t.status=e.status,t.description=e.description,t.finishDate="--"==e.finishDate?"":e.finishDate,t.milestoneTemplateName=e.milestoneTemplateName,t.deliverable=e.deliverable,s.push(t)}),a.milestoneArray=r,a.milestoneUsed=s;Object(o._29)("/sgpm/rest/api/server/milestone/change",a).then(function(t){200==t.data.code?(e.$message.success("提交成功"),e.$router.push("/audititem")):e.$message.error("提交失败"),e.changeBtnloading=!1,e.milepostChangedialogVisible=!1}).catch(function(t){e.changeBtnloading=!1,e.milepostChangedialogVisible=!1})},formatprogressPercentage:function(e){return e.progressPercentage+"%"},formataccumulatedProgress:function(e){return e.accumulatedProgress+"%"},formatisCut:function(e,t){switch(e.isCut){case 1:return"是";case 0:return"否";default:return"未知"}},formatauditDeliverable:function(e){switch(e.auditDeliverable){case"0":return"否";case"1":return"是";default:return"否"}},formatcontractDeliverable:function(e){switch(e.contractDeliverable){case"0":return"否";case"1":return"是";default:return"否"}},formatStatus:function(e){switch(e.status){case 0:return"未完成";case 1:return"进行中";case 2:return"已完成";default:return"未知"}},formatstatus:function(e){switch(e.status){case 1:return"未上传";case 0:return"已上传";case 2:return"待审核";case 3:return"审核通过";case 4:return"驳回";default:return"未知"}}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/audititem"}}},[e._v("审批列表")]),e._v(" "),a("el-breadcrumb-item",[e._v("里程碑变更编辑页")])],1),e._v(" "),a("div",{staticStyle:{height:"10px",background:"#ECF0F5"}}),e._v(" "),a("div",{staticClass:"titleStyle",staticStyle:{"margin-top":"10px","margin-bottom":"0px","margin-left":"5px"}},[a("span",{staticClass:"Title"},[e._v("项目名称：")]),e._v(" "),a("span",{staticClass:"Value"},[e._v(e._s(e.projectName))]),e._v(" "),a("span",{staticClass:"Title"},[e._v("项目编号：")]),e._v(" "),a("span",{staticClass:"Value"},[e._v(e._s(e.projectNumber))])]),e._v(" "),a("div",{staticStyle:{clear:"left"}}),e._v(" "),a("project-milestone",{ref:"projectMilestone",attrs:{datas:e.configDatas},on:{milepostChangeStatus:e.getMilepostChangeStatus}}),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[e._m(0),e._v(" "),a("div",{staticStyle:{float:"left",width:"90%","margin-left":"10px"}},[a("el-input",{attrs:{placeholder:"请输入变更说明"},model:{value:e.changeReason,callback:function(t){e.changeReason=t},expression:"changeReason"}})],1),e._v(" "),a("div",{staticStyle:{clear:"left"}})]),e._v(" "),a("h3",{staticStyle:{"margin-bottom":"10px","margin-top":"10px","margin-left":"5px"}},[e._v("原里程碑模板："+e._s(e.UsedTempName))]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{border:"","header-cell-style":{fontSize:"14px",color:"#303133",height:"51px",padding:0,backgroundColor:"#ccd1d5"},"row-style":{height:"50px"},"cell-style":{padding:0},data:e.milestoneUsed}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{border:"1px solid #ecf0f5","margin-left":"-50px","margin-top":"-20px",background:"#ecf0f5"}},[a("el-table",{staticStyle:{width:"100%","margin-left":"-2px","margin-top":"20px","margin-bottom":"20px"},attrs:{data:t.row.deliverable,border:"","header-cell-style":{fontSize:"14px",color:"#303133",height:"51px",padding:0,backgroundColor:"#ccd1d5"},"row-style":{height:"50px"},"cell-style":{padding:0}}},[a("el-table-column",{attrs:{label:"交付物名称","show-overflow-tooltip":!0,align:"center",prop:"deliverableName"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[1==r.isDownload?a("span",[a("u",[a("a",{staticStyle:{color:"dodgerblue"},attrs:{href:r.template_file_url,target:"_blank"}},[e._v(e._s(r.deliverableName))])])]):a("span",[e._v(e._s(r.deliverableName))])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{label:"状态",align:"center",formatter:e.formatstatus,prop:"status"}}),e._v(" "),e.gtItemStatus?a("el-table-column",{attrs:{label:"是否合同交付物",width:"80",align:"center",formatter:e.formatcontractDeliverable,prop:"contractDeliverable"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{label:"是否审计文档",align:"center",formatter:e.formatauditDeliverable,prop:"auditDeliverable"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"文件名",align:"center",width:"150",prop:"file_name"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[1!=r.status?a("span",[a("u",[a("a",{staticStyle:{color:"dodgerblue"},attrs:{href:r.file_url,target:"_blank"}},[e._v(e._s(r.file_name))])])]):a("span",[e._v(e._s(r.file_name))])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"交付物描述",prop:"description"}})],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"80",prop:"stageName",label:"阶段名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"100",prop:"milestoneName",label:"里程碑名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",formatter:e.formatprogressPercentage,width:"80",prop:"progressPercentage",label:"累计进度"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",formatter:e.formataccumulatedProgress,width:"100",prop:"accumulatedProgress",label:"完成百分比"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"100",prop:"status",formatter:e.formatStatus,label:"当前状态"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"finishDate",label:"实际完成时间"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"currentProblems",label:"当前进展/问题"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"estimatedStartDate",label:"预计开始时间"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"estimatedFinishDate",label:"预计完成时间"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"80",prop:"estimatedWorkingHours",label:"预计工时(人月)"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"description",label:"里程碑描述"}})],1),e._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[a("el-button",{attrs:{loading:e.changeBtnloading,type:"primary",size:"mini"},on:{click:e.milepostChangeSubmit}},[e._v("提交")])],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{float:"left","margin-top":"8px"}},[t("span",{staticStyle:{color:"red"}},[this._v("*")]),this._v("变更说明\n    ")])}]};var p=a("VU/8")(u,d,!1,function(e){a("MrUN")},"data-v-eb9032fe",null);t.default=p.exports}});
//# sourceMappingURL=3.9e425375c8d79f452075.js.map