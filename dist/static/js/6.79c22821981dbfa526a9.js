webpackJsonp([6],{"6pXx":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("bqq5"),n=a("P9l9"),s=a("14gb"),o={name:"ContractMilestone",components:{GenerateForm:r.a},beforeRouteLeave:function(e,t,a){this.fileStatus?window.confirm("系统可能不会保存您所做的更改，确定要离开吗?")?a():a(!1):a()},destroyed:function(){window.onbeforeunload=null},created:function(){},mounted:function(){var e=this;s.a.$on("fileUploadFiles",function(t){t&&t.length>0?(e.fileStatus=!0,window.onbeforeunload=function(e){return(e=e||window.event)&&(e.returnValue="关闭提示"),"关闭提示"}):(e.fileStatus=!1,window.onbeforeunload=null)})},data:function(){return{fileStatus:!1,currentProgress:0,jsonData:{list:[{type:"tabs",name:"",icon:"icon-jilianxuanze",isShow:"true",tabs:[{name:"回款里程碑计划"}],options:{defaultValue:[],width:"",placeholder:"",disabled:!1,clearable:!1,remote:!0,remoteOptions:[],url_a:"",url_b:"",url_c:"",url_d:"",props:{value:"value",label:"label",children:"children"},remoteFunc:"func_1563958033000_83495"},key:"1563958033000_83495",model:"tabs_1563958033000_83495",rules:[]}],config:{labelWidth:100,labelPosition:"top",size:"small"}},editData:{},remoteFuncs:{}}},methods:{handleSubmit:function(){var e=this;this.$refs.generateForm.getData().then(function(t){var a=localStorage.getItem("MilepostParams"),r=JSON.parse(a);e.updateData(r),e.saveReviewlog(r)}).catch(function(e){})},updateData:function(e){var t={},a=[];e.forEach(function(e){var t={};if(t.id=e.projectMilestoneId,t.estimatedStartDate=e.expectedBeginTime,t.estimatedFinishDate=e.expectedEndTime,t.estimatedWorkingHours=e.workHours,t.currentProblems=e.currentProblems,t.accumulatedProgress=e.accumulatedProgress,t.status=e.status,2==e.status){var r=new Date,n=r.getFullYear(),s=(r.getMonth()+1).toString(),o=r.getDate().toString();1==s.length&&(s="0"+s),1==o.length&&(o="0"+o);var i=n+"-"+s+"-"+o;t.finishDate=i;var l=new Date(Date.parse(e.expectedEndTime)),u=(new Date(Date.parse(i))-l)/864e5;t.delayDays=u}var c=[];e.deliverable.forEach(function(e){var t={};t.id=e.deliverableId,t.deliverableName=e.deliverableName,t.fileName=e.fileName,t.filePath=e.filePath,t.description=e.description,t.status=e.status,c.push(t)}),t.deliverable=c,a.push(t)}),t.milestones=a,Object(n._29)("/sgpm/rest/api/server/pm/project/milestones",t).then(function(e){e.data,200==e.data.code?(alert("保存成功"),s.a.$emit("MilePostSave",{code:200,success:!0})):alert("保存失败")}).catch(function(e){})},saveReviewlog:function(e){this.getCurrentProgress(e),this.currentProgress,this.currentProgress;for(var t=[],a=0;a<e.length;a++){(r=e[a]).changeStatus&&t.push(r)}if(t.length>0){var r=t[t.length-1],s={};s.percentageComplete=this.currentProgress/100,s.currentStatus=r.status,s.progressProblems=r.currentProblems,s.projectMilestoneId=r.projectMilestoneId,Object(n._29)("/sgpm/rest/api/server/pm/project/reviewlog",s).then(function(e){e.data,200==e.data.code||alert("保存失败")}).catch(function(e){})}},getCurrentProgress:function(e){var t=0;e.forEach(function(e){t+=e.weight*e.accumulatedProgress}),this.currentProgress=Math.round(t/100)}}},i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-col",{attrs:{span:24}},[t("generate-form",{ref:"generateForm",attrs:{data:this.jsonData,remote:this.remoteFuncs,value:this.editData}})],1)},staticRenderFns:[]},l=a("VU/8")(o,i,!1,null,null,null);t.default=l.exports}});
//# sourceMappingURL=6.79c22821981dbfa526a9.js.map